<!DOCTYPE html>
<html>

<head>
    <title>Antrag stellen</title>
    <!-- Verknüpfung zu Bootstrap-CSS hinzufügen -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
        integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <h1 class="mt-4">Antrag stellen</h1>
        <form id="myForm" action="http://localhost:3000/process_form" method="POST">
            <div class="form-group">
                <label for="personalnummer">Personalnummer:</label>
                <input type="text" class="form-control" id="personalnummer" name="personalnummer" readonly>
            </div>

            <div class="form-group">
                <label for="startdatum">Startdatum Urlaub:</label>
                <input type="date" class="form-control" id="startdatum" name="startdatum" required>
            </div>

            <div class="form-group">
                <label for="enddatum">Enddatum Urlaub:</label>
                <input type="date" class="form-control" id="enddatum" name="enddatum" required>
            </div>
            
            <div class="form-group">
                <label for="reason">Grund für den Urlaub:</label>
                <input type="text" class="form-control" id="reason" name="reason" placeholder="freilassen wenn irrelevant">
            </div>

            <div class="form-group">
                <label for="urlaubstage">Summe Urlaubstage:</label>
                <input type="text" class="form-control" id="urlaubstage" name="urlaubstage" readonly>
            </div>

            <div class="form-group">
                <label>Art des Urlaubs:</label><br>
                <div class="form-check">
                    <input type="radio" class="form-check-input" id="bildungsurlaub" name="urlaubsart"
                        value="Bildungsurlaub">
                    <label class="form-check-label" for="bildungsurlaub">Bildungsurlaub</label>
                </div>

                <div class="form-check">
                    <input type="radio" class="form-check-input" id="umzug" name="urlaubsart" value="Umzug">
                    <label class="form-check-label" for="umzug">Umzug</label>
                </div>

                <div class="form-check">
                    <input type="radio" class="form-check-input" id="normalerUrlaub" name="urlaubsart"
                        value="Normaler Urlaub">
                    <label class="form-check-label" for="normalerUrlaub">Normaler Urlaub</label>
                </div>

                <div class="form-check">
                    <input type="radio" class="form-check-input" id="ueberstundenausgleich" name="urlaubsart"
                        value="Ueberstundenausgleich">
                    <label class="form-check-label" for="ueberstundenausgleich">Überstundenausgleich</label>
                </div>

                <div class="form-check">
                    <input type="radio" class="form-check-input" id="sonderurlaub" name="urlaubsart"
                        value="Sonderurlaub">
                    <label class="form-check-label" for="sonderurlaub">Sonderurlaub</label>
                </div>

            </div>

            <button type="submit" class="btn btn-primary">Antrag abschicken</button>
        </form>
    </div>

    <!-- JavaScript-Funktion, um die Anzahl der Urlaubstage automatisch zu berechnen TODO: Wochenenden + Feiertage ausrechnen-->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            document.getElementById('startdatum').addEventListener('change', updateUrlaubstage);
            document.getElementById('enddatum').addEventListener('change', updateUrlaubstage);

            var user_id;
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Check if this is the cookie we're looking for
                if (cookie.startsWith('user_id' + '=')) {
                    user_id = cookie.split('user_id=')[1];
                }
            }
            document.getElementById('personalnummer').value = user_id;

            function updateUrlaubstage() {
                var startdatum = new Date(document.getElementById('startdatum').value);
                var enddatum = new Date(document.getElementById('enddatum').value);
                const oneDay = 24 * 60 * 60 * 1000; // One day in milliseconds
                let weekdayCount = 0;
                while (startdatum <= enddatum) {
                    const dayOfWeek = startdatum.getDay(); // 0 for Sunday, 1 for Monday, ..., 6 for Saturday
                    if (dayOfWeek !== 0 && dayOfWeek !== 6) {
                        // Count the day if it's not a weekend (Saturday or Sunday)
                        weekdayCount++;
                    }

                    // Move to the next day
                    startdatum = new Date(startdatum.getTime() + oneDay);
                }
                document.getElementById('urlaubstage').value = weekdayCount;
            }
        });

        document.getElementById('myForm').addEventListener('submit', function (event) {
            // Add custom validation logic here
            if (!validateForm()) {
                event.preventDefault(); // Prevent form submission
            }
        });

        function validateForm() {
            var personalnummer = document.getElementById('personalnummer').value;
            var startdatum = document.getElementById('startdatum').value;
            var enddatum = document.getElementById('enddatum').value;
            // Add more fields as needed

            // Check if personalnummer is a number
            if (isNaN(personalnummer)) {
                alert('Personalnummer must be a number.');
                return false;
            }

            // Check if startdatum is before enddatum
            if (new Date(startdatum) > new Date(enddatum)) {
                alert('Das Startdatum muss vor dem Enddatum liegen.');
                return false;
            }

            // Check if startdatum are after todays date
            if (new Date(startdatum) < new Date()) {
                alert('Das Startdatum muss mindestens morgen sein.');
                return false;
            }

            // Check if enddatum are after todays date
            if (new Date(enddatum) < new Date()) {
                alert('Das Enddatum muss mindestens morgen sein.');
                return false;
            }

            // Add more validation logic as needed
            return true;
        }
    </script>
</body>

</html>